---
import BaseLayout from '../layouts/BaseLayout.astro';

const experience = [
  {
    period: '2023 – present',
    role: 'PhD Student',
    orgs: [
      { name: 'Université de Montréal', url: 'https://www.umontreal.ca' },
      { name: 'Mila', url: 'https://mila.quebec' },
    ],
    description: 'Identifiable representation learning theory and interpretability. My work establishes when learned representations provably recover latent structure, how , and what causal inference contributes to mechanistic interpretability of large language models. Current focus: structural misspecification of identifiability metrics and the gap between associational and causal claims in interpretability.',
    mentor: { name: 'Dhanya Sridhar', url: 'https://dsridhar.com' },
    tags: ['identifiability', 'causality', 'interpretability', 'LLMs'],
    type: 'education' as const,
  },
  {
    period: '2021 – 2023',
    role: "Master's Student",
    orgs: [
      { name: 'Université de Montréal', url: 'https://www.umontreal.ca' },
      { name: 'Mila', url: 'https://mila.quebec' },
    ],
    description: 'Investigated the causal competence of model-based RL agents: whether world models acquire long-horizon predictive structure or degenerate to short-range pattern matching. Designed physics simulations for controlled evaluation of agent planning and memory. Thesis work addressed the distinction between statistical fit and genuine environment understanding in learned dynamics models. The gap between statistical fit and causal competence became the central question of my subsequent work.',
    mentor: { name: 'Devon Hjelm', url: 'https://scholar.google.com/citations?user=68c5HfwAAAAJ&hl=en' },
    tags: ['world models', 'reinforcement learning', 'causal reasoning'],
    type: 'education' as const,
  },
  {
    period: '2019 – 2021',
    role: 'Research Programmer',
    orgs: [
      { name: 'Empirical Inference, Max Planck Institute for Intelligent Systems', url: 'https://is.mpg.de/ei' },
    ],
    description: 'Real-time control software for robotic systems and development of the accompanying simulation package for hardware-independent testing. Research on self-supervised representation learning, specifically systematic generalisation: whether learned features compose under novel combinations of known factors or silently overfit to the training distribution. This raised the question I have worked on since: how to evaluate whether a representation has genuinely captured structure, rather than memorised surface statistics.',
    mentors: [
    { name: 'Bernhard Schölkopf', url: 'https://is.mpg.de/ei/person/bs'},
    { name: 'Stefan Bauer', url: 'https://www.professoren.tum.de/en/bauer-stefan'},
    ],
    tags: ['robotics', 'self-supervised learning', 'open-source software', 'systematic generalisation'],
    type: 'work' as const,
  },
  {
    period: 'Fall 2022',
    role: 'Research Intern',
    orgs: [
      { name: 'ServiceNow Research', url: 'https://www.servicenow.com/research/' },
    ],
    description: 'Adapted language models for text-based reinforcement learning environments (Jericho), where the agent must parse natural language observations, maintain belief state, and act in a combinatorial action space. This was sequential decision-making under language, before large-scale pretraining made the language part easy—model capacity was scarce and architectural choices were consequential. The experience sharpened the same question in a different modality: what separates a model that tracks state from one that merely correlates with it.',
    tags: ['reinforcement learning', 'language grounding'],
    type: 'work' as const,
  },
  {
    period: '2015 – 2019',
    role: "Bachelor's in Electrical Engineering",
    orgs: [
      { name: 'Indian Institute of Technology Kanpur', url: 'https://www.iitk.ac.in' },
    ],
    description: 'Research across optimisation, stochastic modelling, and formal methods: physics simulation design (BulletPhysics, C++) for deformable object manipulation, dynamic programming formulations for supply chain management, online convex optimisation, stochastic geometry and spatial point processes, and Z3-based reasoning for multi-agent social deduction. Consistent thread: taking loosely specified applied problems and giving them formal structure.',
    mentors: [
      { name: 'Dmitry Berenson', url: 'https://web.eecs.umich.edu/~dmitryb/', note: 'deformable object manipualtion, University of Michigan' },
      { name: 'Amar Sapra', url: 'https://www.iimb.ac.in/user/142/amar-sapra', note: 'supply chain, IIM Bangalore' },
      { name: 'Indranil Saha', url: 'https://www.cse.iitk.ac.in/users/isaha/', note: 'Z3 multi-agent reasoning, IIT Kanpur' },
    ],
    tags: ['optimisation', 'physics simulation', 'stochastic processes', 'formal methods'],
    type: 'education' as const,
  },
];

const typeStyles = {
  education: {
    dot: 'bg-accent-500',
    badge: 'bg-accent-50 text-accent-700 border-accent-200 dark:bg-accent-950 dark:text-accent-300 dark:border-accent-800',
  },
  industry: {
    dot: 'bg-emerald-500',
    badge: 'bg-emerald-50 text-emerald-700 border-emerald-200 dark:bg-emerald-950 dark:text-emerald-300 dark:border-emerald-800',
  },
};
---

<BaseLayout title="Experience — Your Name">
  <h1 class="text-2xl font-semibold text-zinc-900 dark:text-zinc-50 tracking-tight mb-2">
    Experience
  </h1>
  <p class="text-sm text-zinc-500 dark:text-zinc-400 mb-10">
    Research and education timeline.
    <a href="/cv.pdf" class="link-underline ml-1">Full CV (PDF) ↗</a>
  </p>

  <!-- Timeline -->
  <div class="relative">
    <!-- Vertical line -->
    <div class="absolute left-[7px] top-2 bottom-2 w-px bg-zinc-200 dark:bg-zinc-800"></div>

    <div class="space-y-10">
      {experience.map((item) => {
        const styles = typeStyles[item.type];
        return (
          <div class="relative pl-8">
            {/* Dot */}
            <div class={`absolute left-0 top-1.5 w-[15px] h-[15px] rounded-full border-[3px] border-white dark:border-zinc-950 ${styles.dot}`}></div>

            {/* Content */}
            <div>
              <div class="flex flex-wrap items-center gap-2 mb-1">
                <span class="text-xs font-mono text-zinc-400 dark:text-zinc-500">
                  {item.period}
                </span>
                <span class={`text-[10px] font-medium px-2 py-0.5 rounded-full border ${styles.badge}`}>
                  {item.type}
                </span>
              </div>

              <h3 class="text-base font-medium text-zinc-900 dark:text-zinc-100">
                {item.role}
              </h3>
              <p class="text-sm text-zinc-500 dark:text-zinc-400">
                {item.orgs.map((org, idx) => (
                  <Fragment>
                    {idx > 0 && <span class="text-zinc-300 dark:text-zinc-600"> · </span>}
                    <a href={org.url} target="_blank" rel="noopener" class="link-underline">{org.name}</a>
                  </Fragment>
                ))}
              </p>

              <p class="mt-2 text-sm text-zinc-600 dark:text-zinc-400 leading-relaxed max-w-xl">
                {item.description}
              </p>

              {/* Single mentor — small, dotted underline, clickable */}
              {item.mentor && (
                <p class="mt-1.5 text-xs text-zinc-400 dark:text-zinc-500">
                  {item.mentor.note ? (
                    <Fragment>
                      with <a href={item.mentor.url} target="_blank" rel="noopener" class="hover:text-zinc-600 dark:hover:text-zinc-300 underline decoration-dotted underline-offset-2 transition-colors">{item.mentor.name}</a>
                      <span class="text-zinc-300 dark:text-zinc-600"> · </span>
                      <span>{item.mentor.note}</span>
                    </Fragment>
                  ) : (
                    <Fragment>
                      advised by <a href={item.mentor.url} target="_blank" rel="noopener" class="hover:text-zinc-600 dark:hover:text-zinc-300 underline decoration-dotted underline-offset-2 transition-colors">{item.mentor.name}</a>
                    </Fragment>
                  )}
                </p>
              )}

              {/* Multiple mentors — subtle dotted links with notes */}
              {item.mentors && (
                <p class="mt-1.5 text-xs text-zinc-400 dark:text-zinc-500">
                  {item.mentors.map((m, idx) => (
                    <Fragment>
                      {idx > 0 && <span class="text-zinc-300 dark:text-zinc-600"> · </span>}
                      <a href={m.url} target="_blank" rel="noopener" class="hover:text-zinc-600 dark:hover:text-zinc-300 underline decoration-dotted underline-offset-2 transition-colors">{m.name}</a>
                      {m.note && <span class="text-zinc-300 dark:text-zinc-600"> ({m.note})</span>}
                    </Fragment>
                  ))}
                </p>
              )}

              {item.tags.length > 0 && (
                <div class="mt-2 flex flex-wrap gap-1.5">
                  {item.tags.map((tag) => (
                    <span class="tag text-[10px]">{tag}</span>
                  ))}
                </div>
              )}
            </div>
          </div>
        );
      })}
    </div>
  </div>

  <!-- Skills / Tools (compact) -->
  <section class="mt-16 pt-8 border-t border-zinc-100 dark:border-zinc-800/50">
    <h2 class="section-heading">Tools & Languages</h2>
    <div class="flex flex-wrap gap-2 text-sm text-zinc-500 dark:text-zinc-400">
      {['Python', 'PyTorch', 'JAX', 'C++', 'TypeScript', 'Rust', 'Git', 'Docker', 'LaTeX', 'Weights & Biases', 'HPC / SLURM'].map((tool) => (
        <span class="px-3 py-1 rounded-lg border border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900 text-xs font-medium">
          {tool}
        </span>
      ))}
    </div>
  </section>
</BaseLayout>
